function Pagination(){var b=1;
var a=1;
var c=0;
this.previous=function(){if(b>1){return --b;
}};
this.next=function(){if(b*a<c){return ++b;
}};
this.current=function(){return b;
};
this.isFirstPage=function(){return(b==1);
};
this.isLastPage=function(){return(b*a>=c);
};
this.getDefault=function(){return(b=1);
};
this.reset=function(){b=1;
};
this.setGridSize=function(d){a=d;
};
this.getGridSize=function(){return a;
};
this.setTotalRows=function(d){c=d;
};
this.getTotalRows=function(){return c;
};
}function aSyncPostRequest(c,a){show_loading();
var b=jQuery.ajax({url:c.url,type:"POST",contentType:"application/x-www-form-urlencoded",data:c.query});
b.done(function(){a.success({data:arguments[0],status:arguments[1],jqXHR:arguments[2]});
});
b.fail(function(){a.failure({response:arguments[0],status:arguments[1],errorThrown:arguments[2]});
});
b.always(function(){hide_loading();
if(typeof isDubaiTradeTheme!="undefined"&&isDubaiTradeTheme==true){dtframeResizer.postHeightChanges();
}});
}function aSyncGetRequest(c,a){show_loading();
var b=jQuery.ajax({url:c.url,type:"GET",contentType:"application/x-www-form-urlencoded",data:c.query});
b.done(function(){a.success({data:arguments[0],status:arguments[1],jqXHR:arguments[2]});
});
b.fail(function(){a.failure({response:arguments[0],status:arguments[1],errorThrown:arguments[2]});
});
b.always(function(){hide_loading();
if(typeof isDubaiTradeTheme!="undefined"&&isDubaiTradeTheme==true){dtframeResizer.postHeightChanges();
}});
}var genericModule=angular.module("generic-app",[]);
genericModule.factory("factory",function(){return new function(){this.callMethod=function(scope,methodName,parameters){eval(scope.$interpolate("scope.{{method}}({{params}})")({method:methodName,params:parameters}));
};
};
});
var searchModule=angular.module("search-app",["generic-app"]);
searchModule.provider({$exceptionHandler:function(){var a=function(b,c){};
this.$get=function(){return a;
};
}});
searchModule.factory("searchFactory",function(){return new function(){this.constructPagination=function(){return new Pagination();
};
this.ajaxCall=aSyncPostRequest;
};
});
searchModule.directive("myRepeatDirective",function(){return function(c,b,a){window.myRepeatFn(c,b,a);
};
});
searchModule.directive("customAngTable",function(){return{restrict:"E",link:function(c,b,a){window.myTableRenderer(c,b,a);
}};
});
searchModule.directive("onFinishRender",["$timeout","$parse",function(a,b){return{restrict:"A",link:function(e,d,c){if(e.$last===true){a(function(){e.$emit("ngRepeatFinished");
if(!!c.onFinishRender){b(c.onFinishRender)(e);
}});
}}};
}]);
searchModule.filter("date_iso",function(){return function(b){if(!b){return"";
}var a=parseDate(b,"yyyy-MM-dd");
return formatDate(a,"dd-MM-yyyy");
};
});
searchModule.filter("trim",function(){return function(c,e,a,b){if(!c){return"";
}a=parseInt(a,10);
if(!a){return c;
}if(c.length<=a){return c;
}c=c.substr(0,a);
if(e){var d=c.lastIndexOf(" ");
if(d!=-1){c=c.substr(0,d);
}}return c+(b||" ï¿½");
};
});
function getAngularScopeObject(b,a){a=a||0;
return angular.element($(b)[a]).scope();
}function nonAngularCall(c,b){if(b&&b.controllerIndex){var a=getAngularScopeObject("[data-ng-controller='searchController']",b.controllerIndex);
}else{var a=getAngularScopeObject("[data-ng-controller='searchController']",0);
}angular.element($("[data-ng-app='search-app']")).injector().get("factory").callMethod(a,c,b);
}function errorPanel(a,d){staticErrorMsgHandling(a,d,function(){nonAngularCall("hideOnError");
});
var b=$("ul[id='errorsList']:last");
var c=$("div[id='messageErrors']:last");
if(a){b.html(d);
c.show();
nonAngularCall("hideOnError");
}else{b.html("");
c.hide();
}}function fail_(a){fail(a.response.responseText);
}function checkErrorMsg(b){var d,c;
if(b["error-msg"]){d=b["error-msg"];
}else{if(b.errors){d=b.errors;
}else{d=b;
}}c=d;
if(!$.isArray(c)){var a=$($.trim(d));
if(c=a.find("#c_incident_no").val()){c=buildIncidentContextMsgIfAny(c);
}else{if(c=a.find("#errorsList").html()){}else{return undefined;
}}}return c;
}function fail(a){var b;
if(b=checkErrorMsg(a)){}else{b=JAVASCRIPT_EXCEPTION_MSG;
}errorPanel(true,b);
}function buildIncidentContextMsgIfAny(a){return JAVASCRIPT_EXCEPTION_MSG+(a?INCIDENT_MSG.replace("{0}",a):"");
}function checkIfErrorAndHandle(a){if(!a.data["data-set"]&&$.trim(a.data)!=""){var b=checkErrorMsg(a.data);
if(b){errorPanel(true,b);
}return true;
}return false;
}function searchController(t,j,B,i,q){var v=B.constructPagination();
var w="init";
var l={successPanel:{wrapClass:"message-container",dataId:"message-data"},onClickExpr:"#search",prevId:"prv",nextId:"nxt",gridClass:"search-grid-container",initTotalRows:0,responsiveClass:"responsive",hideNavBar:false,hideOnError:true,searchPopup:true,sorting:false,fullDto:false};
var u=new function(){this.criteria=undefined;
this.getUrl=function(F,G,E,H,I){return{query:C(G,I,E,F),url:D(G,H,I)};
};
this.getId=function(E){return"#"+E;
};
this.getClazz=function(E){return"[class*='"+E+"']:last";
};
function D(G,F,H){var E="";
if(H&&H.action){E=H.action;
}else{if(F){E=F;
}else{if(!G||!G.attr("action")){}E=G.attr("action");
}}return E;
}function C(G,I,E,F){var H=u.criteria;
if(H==undefined){H="value(displayTable)=true&";
if(G){H+=G.serialize()+"&";
}if(l.sorting){if($("#orderMode")){H+="value(orderMode)="+$("#orderMode").val()+"&";
}if($("#orderColumn")){H+="value(orderColumn)="+$("#orderColumn").val()+"&";
}}if(F){H+="embedded=true&";
}if(l.searchPopup){u.criteria=H;
}}H+="_="+new Date().getTime()+"&pageNumber=";
if(I&&I.navigate){H+=(I.navigate==">"?E.next():I.navigate=="<"?E.previous():I.navigate=="="?E.current():E.getDefault());
}else{if(!(I&&I.rowIndex>-1)){E.reset();
}else{}}return H;
}};
t.serverGrid=[];
t.dataSet=[];
t.$interpolate=j;
t.nonPagedtotalRows=l.initTotalRows;
t.metadata=v;
t.urlBuilder=u;
t.init=function(D){if(D){$.extend(true,l,D);
}t.totalRows=l.initTotalRows;
z();
$(l.onClickExpr).click(function(E){C(this);
});
$(l.onEnterExpr).keypress(function(E){if(l.onEnterNotExpr){if($(E.target).is(l.onEnterNotExpr)){return;
}}if(E.keyCode==13){E.preventDefault();
C($(l.onClickExpr).get(0));
}});
function C(E){if(E.form){t.cFormId=E.form.id;
}else{return;
}if(k(E)===false){return false;
}t.search();
}if(l.onLoadAction){$(document).ready(function(G){if(l.action){var F=l.action;
l.action=l.onLoadAction;
t.search();
l.action=F;
}else{var E=$(u.getId(t.cFormId));
var F=$(E).attr("action");
$(E).attr("action",l.onLoadAction);
t.search();
$(E).attr("action",F);
}});
}t.paginationTemplate='<div id="'+l.responsiveClass+'Navbararrows" class="text-right"><ul class="pagination pagination-md"><li id="'+l.responsiveClass+'PrevArrow"><a title="Previous" class="no-enter-search" data-page="prev" id="'+l.responsiveClass+'prv"  href="#prev"><i class="icon-chevron-left"></i></a></li><li id="'+l.responsiveClass+'NextArrow"><a title="Next" class="no-enter-search" data-page="next" id="'+l.responsiveClass+'nxt" href="#next"><i class="icon-chevron-right"></i></a></li></ul></div>';
if(l.onLoadModel){a({data:l.onLoadModel},d.preInvarientFn,d.onLoadModelLogicFn);
}};
function k(E){var D=$(E);
var C=D.data("search-validator")||D.data("old-onclick")||"";
if(C){C=C.replace(/\(\)/gi,"");
C=C.replace(/\;/gi,"");
C=C.replace(/return /gi,"");
C=C.replace(/ /gi,"");
}return C&&window[C].apply(E,[]);
}function z(){var C=$(l.onClickExpr);
C.each(function(){var E=$(this);
var D=E.attr("onclick");
E.attr("data-old-onclick",D);
E.removeAttr("onclick");
});
}function r(){if(!l.hideNavBar&&w=="init"){$(t.paginationTemplate).insertAfter(u.getClazz(l.responsiveClass));
$(u.getId(l.responsiveClass+l.prevId)).click(function(D){if(!v.isFirstPage()){try{invokeParentSearchAction();
}catch(C){}t.search({navigate:"<"});
}});
$(u.getId(l.responsiveClass+l.nextId)).click(function(D){if(!v.isLastPage()){try{invokeParentSearchAction();
}catch(C){}t.search({navigate:">"});
}});
}}t.enableEditMode=function(D){errorPanel(false);
var C=u.getId(t.cFormId);
$(C+" input,"+C+" input[type='hidden'],"+C+" textarea").each(function(){b(D,$(this),e);
});
$(C+" select").each(function(){b(D,$(this),m);
});
};
t.update=function(C){n(C,function(D){return D.status=="success";
},function(E){var D=t.serverGrid[C.rowIndex];
jQuery.each(D,function(G,H){if(l.editAddMapping&&l.editAddMapping[G]){D[G]=window[l.editAddMapping[G]]();
}else{var F=$("[name='value("+G+")']");
if(F){D[G]=F.val();
}}});
t.$apply(function(){t.serverGrid[C.rowIndex]=D;
t.nonPagedtotalRows=t.serverGrid.length;
});
});
};
t.add=function(C){n(C,function(D){return D.status=="success";
},function(E){var D={};
$(u.getId(t.cFormId)).find(":input").each(function(){D[x($(this).attr("name"))]=$(this).val();
});
$.each(l.editAddMapping,function(F,G){D[F]=window[l.editAddMapping[F]]();
});
t.$apply(function(){t.serverGrid.push(D);
t.nonPagedtotalRows=t.serverGrid.length;
});
});
};
t.remove=function(C){n(C,function(D){return D.status=="success";
},function(D){if(!$("#"+l.responsiveClass+"Navbararrows").is(":visible")){t.$apply(function(){t.serverGrid.splice(C.rowIndex,1);
t.nonPagedtotalRows=t.serverGrid.length;
t.metadata.setTotalRows(t.serverGrid.length);
});
}else{t.search({navigate:t.serverGrid.length==1&&!v.isFirstPage()?"<":"="});
}});
};
t.refresh=function(){t.search({navigate:"="});
};
var d={preInvarientFn:function(C){if(C&&C.data&&C.data["error-msg"]){fail(C.data["error-msg"]);
return false;
}return C;
},searchLogicFn:function(C){o(C.data,function(){t.$apply(function(){s(C.data);
});
});
},onLoadModelLogicFn:function(C){o(C.data,function(){s(C.data);
});
}};
function o(D,C){if(!D["data-set"]){errorPanel(true,JAVASCRIPT_EXCEPTION_MSG);
return;
}C();
}function p(C){if(l.searchPopup){if(!(C&&C.navigate)){u.criteria=undefined;
}}}t.search=function(C){p(C);
n(C,d.preInvarientFn,d.searchLogicFn);
};
t.hideOnError=function(){if(l.hideOnError){t.showGridPanel(false);
}};
t.showMessagePanel=function(C,E){var D={panel:function(){return $(u.getClazz(l.successPanel.wrapClass));
},data:function(){return $(u.getId(l.successPanel.dataId));
},table:$(u.getClazz(l.responsiveClass))};
if(C){D.table.hide();
if(!D.data().prop("tagName")){D.table.after(h(l.successPanel.wrapClass,l.successPanel.dataId));
}D.data().html(E);
D.panel().show();
}else{D.table.show();
D.panel().hide();
}};
function h(C,D){return'<div class="'+C+'" style="display: none;"><div class="alert alert-info"><strong id="'+D+'"></strong></div></div>';
}function g(){if(v.isFirstPage()&&v.isLastPage()||v.getTotalRows()<=v.getGridSize()){$(u.getId(l.responsiveClass+"Navbararrows")).hide();
}else{if(v.isFirstPage()){$("#"+l.responsiveClass+"PrevArrow").addClass("disabled");
}else{$("#"+l.responsiveClass+"PrevArrow").removeClass("disabled");
}if(v.isLastPage()){$("#"+l.responsiveClass+"NextArrow").addClass("disabled");
}else{$("#"+l.responsiveClass+"NextArrow").removeClass("disabled");
}$(u.getId(l.responsiveClass+"Navbararrows")).show();
}}function c(){var C=null;
if(!l.fullDto){C=t.serverGrid.length>0;
}else{C=t.dataSet.pagedResults.results.length>0;
}if(!C){t.showMessagePanel(true,NO_RECORD_FOUND_MSG);
}t.showGridPanel(true);
g();
A();
if(w=="ajaxed"||(w=="init"&&!l.onLoadModel)){errorPanel(false);
}w="ajaxed";
$(document).trigger("angular_on_ajax_completed");
}t.showGridPanel=function(D){var C=$(u.getClazz(l.gridClass));
D?C.show():C.hide();
};
function y(E){var D=null;
if(t.cFormId){D=$(u.getId(t.cFormId));
}var C=false;
if(w=="init"&&l.onLoadModel){C=true;
}return u.getUrl(C,D,v,l.action,E);
}function a(C,E,D){if(!checkIfErrorAndHandle(C)){t.showMessagePanel(false);
if(E(C)){D(C);
r();
c();
}}if(l.postMethod){window[l.postMethod](C);
}}function f(C){return C;
}function n(E,D,C){B.ajaxCall(y(E),{success:function(F){a(F,D,C);
},failure:function(F){fail_(F);
}});
}function e(D,C){D.val(C);
}function m(D,C){D.children('option[value="'+C+'"]').prop("selected",true);
}function b(H,D,G){var F=D.attr("name");
if(F){var E=x(F);
var C=t.serverGrid[H][E];
if(C){G(D,C);
}}}function x(C){if(C){return C.replace("value(","").replace(")","");
}return C;
}function s(C){if(!l.fullDto){t.serverGrid=C["data-set"];
if(C["meta-data"]!=null){v.setGridSize(C["meta-data"]["grid-size"]);
v.setTotalRows(C["meta-data"]["total-rows"]);
}else{t.nonPagedtotalRows=C["data-set"].length;
}}else{t.dataSet=C["data-set"];
if(C["data-set"]["pagedResults"]["fullListSize"]!=null){v.setGridSize(C["data-set"]["pagedResults"]["objectsPerPage"]);
v.setTotalRows(C["data-set"]["pagedResults"]["fullListSize"]);
}else{t.nonPagedtotalRows=C["data-set"]["pagedResults"]["fullListSize"].length;
}}}function A(){responsiveTable.createAll(!l.onLoadModel);
if(w!="init"){responsiveTable.ajaxBugFix();
}}t.$on("ngRepeatFinished",function(C){if(typeof isDubaiTradeTheme!="undefined"&&isDubaiTradeTheme==true){resizeDPPIFrame();
}});
}searchController.$inject=["$scope","$interpolate","searchFactory","$exceptionHandler","$window","$timeout","$parse"];
var currPageItems=new Array();
var selectedIds=new Array();
var selectedValues=new Object();
var pageItemCount=0;
searchModule.directive("rowSelectorDirective",function(){return function(c,b,a){var d=$("#selectedRows").val();
if($.inArray(c.data.detailId,selectedIds)>-1){currPageItems.push(c.data.detailId);
}pageItemCount++;
};
});
function selectItem(c,b){if($("#multiValued1-"+c).is(":checked")){selectedIds.push(c);
selectedValues[c]=b;
var a='<div id="'+c+'"> <input type="hidden" name="multiValued1" value="'+b+'"/></div>';
$("#selectedIdsDiv").append(a);
}else{removeUnChecked(c);
}}function removeUnChecked(b){var a=0;
while(a<selectedIds.length){if(selectedIds[a]==b){selectedIds.splice(a,1);
$("#"+b).remove();
$("#allSelected").prop("checked",false);
}else{a++;
}}}$(document).on("angular_on_ajax_completed",function(){var c=false;
var a=currPageItems.length;
if(currPageItems.length>0){for(var d=0;
d<a;
d++){var g=currPageItems.pop();
$("#multiValued1-"+g).prop("checked",true);
}}var f=selectedIds.slice(0,selectedIds.length);
if(f.length>0){var b="";
var e=f.length;
for(var d=0;
d<e;
d++){var g=f.pop();
b+='<div id="'+g+'"> <input type="hidden" name="multiValued1" value="'+g+'"/></div>';
$("#multiValued1-"+g).prop("checked",true);
}if(a==pageItemCount){$("#allSelected").prop("checked",true);
}else{$("#allSelected").prop("checked",false);
}$("#selectedIdsDiv").html(b);
pageItemCount=0;
}});
function trackSelected(b){if(b!=undefined&&b!=null&&b!=""){for(var a=0;
a<b.length;
a++){selectedIds[a]=b[a]+"";
}}}searchModule.directive("firstRowSelector",function(){return function(c,b,a){$("#printReqRes a").first().focus();
};
});
